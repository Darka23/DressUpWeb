@{
    ViewData["Title"] = "Shopping Cart";
}

<style>
    .product-img {
        width: 200px;
        margin-right: -300px;
    }

    th {
        width: 10%;
    }
</style>


<h1>Shopping Cart</h1>

<table class="table table-striped">
    <thead>
        <tr>
            <th scope="col">Product</th>
            <th scope="col">Name</th>
            <th scope="col">Price</th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody id="cartContent">
    </tbody>
</table>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>

    $(document).ready(function() {

        const tbody = $("#cartContent");

        let lsObj = [];

        if (localStorage.getItem("Cart")) {
            lsObj = JSON.parse(localStorage.getItem("Cart"))
            }

        if(lsObj.length <= 0) {return;}

        let options = {};

        lsObj.forEach(x=> {

            options.url = "/Cart/GetCartItemFor"+x.type;
            options.type = "GET";
            options.data = {"id": x.id};
            options.dataType = "json";

            options.success = (data) => {

                    tbody.append(`
                        <tr id="`+ x.type+x.id +`">
                            <td><img class="product-img" src="`+ data.imageUrl + `" /></td>
                            <td>`+ data.name +`</td>
                            <td>`+ data.price.toFixed(2) +"лв."+`</td>
                            <td>
                                <a onclick="RemoveFromCart(this)">
                                    <i class="fa-solid fa-circle-xmark"></i>
                                </a>
                            </td>
                        </tr>`)
        }

        $.ajax(options);

        });
    });

            function RemoveFromCart(el){

                const tr = $(el).closest("tr");

               let cart = JSON.parse(localStorage.getItem("Cart"));

               cart.forEach(x=>{

                   if (cart.filter(x => x.objId == tr).length <= 0) {
                        cart.splice(cart.indexOf(x), 1);
                        console.log(cart);
                   }

                })
                localStorage.setItem("Cart", JSON.stringify(cart));

                tr.remove();
                          
            }
</script>